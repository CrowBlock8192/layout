webpackJsonprmsh([23,49],{"56nC":function(t,e){},AgyS:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("3cXf"),o=a.n(r),i=a("0xDb"),n=a("HMPb"),s=a("WkoH"),l={name:"orgManage",components:{orgTree:n.a,orgUpdate:s.default},props:["siteContentViewHeight"],data:function(){return{Height:{height:document.documentElement.clientHeight-200+"px"},orgUpdateVisable:!1,dialogTitle:"",treeData:[],nodeId:"",tableData:[],currentRow:{},isEdit:!0,keyWord:"",page:{pageNum:1,pageSize:10,pageSizes:[10,20,30,40,50],total:0}}},created:function(){this.initOrgTree()},methods:{initOrgTree:function(){var t=this;t.$http({url:t.$http.adornUrl(t.API.getOrganizationTree),method:"post",data:t.$http.adornData()}).then(function(e){var a=e.data;0===a.code?(t.treeData=a.data,t.orgTreeClick(t.treeData[0]),t.nodeId=t.treeData[0].id,t.getUserData()):t.$message.error(res.msg)}).catch(function(e){t.$message.error(e)})},orgTreeClick:function(t){this.nodeId=t.id,this.getUserData()},indexMethod:function(t){return t+1},getUserData:function(){var t=this,e=t.nodeId,a=t.keyWord;if(null===e||""===e)return this.$message({type:"warning",message:"请选择结构节点！"}),!1;t.$http({url:t.$http.adornUrl(t.API.getOrganztListByB0000),method:"post",data:t.$http.adornData({pageNum:t.page.pageNum,pageSize:t.page.pageSize,orgId:e,orgName:a})}).then(function(e){var a=e.data;0===a.code&&(t.tableData=a.data,t.page.total=a.total)}).catch(function(t){})},handleSizeChange:function(t){this.page.pageSize=t,this.getUserData()},handleCurrentChange:function(t){this.page.pageNum=t,this.getUserData()},searchUser:function(){this.getUserData()},addUser:function(){this.nodeId?this.currentRow.orgPid=this.nodeId:this.currentRow.orgPid="0",this.dialogTitle="添加机构",this.orgUpdateVisable=!0,this.isEdit=!1},updateUser:function(t){this.currentRow=t,this.dialogTitle="编辑机构",this.orgUpdateVisable=!0,this.isEdit=!0},updateCallback:function(t){t&&(this.getUserData(),this.initOrgTree()),this.orgUpdateVisable=!1},selectionChangeHandle:function(t){this.tableDataSelections=t},moveDirection:function(t){var e,a=this;a.tableDataSelections.sort(function(t,e){return a.tableData.indexOf(t)-a.tableData.indexOf(e)}),"down"==t&&a.tableDataSelections.reverse(),a.tableDataSelections.forEach(function(r){e=a.tableData.indexOf(r),"up"==t?a.moveUp(e):"down"==t&&a.moveDown(e)})},moveUp:function(t){0!=t&&(this.tableData=Object(i.d)(this.tableData,t,t-1,"up"))},moveDown:function(t){t!=this.tableData.length-1&&(this.tableData=Object(i.d)(this.tableData,t,t+1,"down"))},saveSort:function(){var t=this,e=[];this.tableData.length<0||(this.tableData.forEach(function(t,a){e.push({orgId:t.orgId,orderno:a+1})}),this.$http({url:this.$http.adornUrl(this.API.orgSort),method:"post",data:this.$http.adornData({data:o()(e)})}).then(function(e){var a=e.data;a&&0===a.code?(t.$message.success("操作成功"),t.getUserData()):t.$message.error(a.msg)}))},delUser:function(t){var e=this;e.$confirm("确定删除本条数据？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$http({url:e.$http.adornUrl(e.API.deleteOrganization),method:"post",data:e.$http.adornData({orgId:t.orgId})}).then(function(t){0===t.data.code?(e.$message.success("删除成功"),e.getUserData(),e.initOrgTree()):e.$message.error("删除失败")}).catch(function(t){})})}},watch:{filterText:function(t){this.$refs.orgTree.filter(t)},fullHeight:function(t){if(!this.timer){this.fullHeight=t,this.timer=!0;var e=this;setTimeout(function(){e.timer=!1},400)}}},mounted:function(){var t=this;window.onresize=function(){return window.fullHeight=document.documentElement.clientHeight,void(t.fullHeight=window.fullHeight)}}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",{staticClass:"orgManage"},[a("el-container",{staticStyle:{height:"100%"}},[a("el-aside",{attrs:{width:"20%"}},[a("div",{style:{height:t.siteContentViewHeight-10+"px",overflow:"auto"}},[a("org-tree",{ref:"orgTree",attrs:{treeData:t.treeData},on:{"node-click":t.orgTreeClick}})],1)]),t._v(" "),a("el-main",[a("div",{staticClass:"search"},[a("div",[a("el-col",{attrs:{span:19}},[a("el-input",{attrs:{size:"small",placeholder:"请输入机构名"},model:{value:t.keyWord,callback:function(e){t.keyWord=e},expression:"keyWord"}})],1),t._v(" "),a("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:3}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.searchUser}},[t._v("检索")])],1)],1),t._v(" "),a("div",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.addUser}},[t._v("添加")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.moveDirection("up")}}},[t._v("上移")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.moveDirection("down")}}},[t._v("下移")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.saveSort}},[t._v("保存排序")])],1)]),t._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,"tooltip-effect":"dark",height:t.siteContentViewHeight-100+"px"},on:{"selection-change":t.selectionChangeHandle}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{width:"50px",fixed:"",type:"index",index:t.indexMethod,label:"序号",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"orgCode",label:"机构代码"}}),t._v(" "),a("el-table-column",{attrs:{prop:"orgName",label:"机构名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"orgType",label:"机构类型"},scopedSlots:t._u([{key:"default",fn:function(e){return["1"==e.row.orgType?a("div",[t._v("单位")]):a("div",[t._v("部门")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"orgStatus",label:"机构状态"},scopedSlots:t._u([{key:"default",fn:function(e){return["1"==e.row.orgStatus?a("el-tag",{attrs:{size:"medium",type:"error"}},[t._v("禁用")]):"0"==e.row.orgStatus?a("el-tag",{attrs:{size:"medium",type:"success"}},[t._v("启用")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",plain:"",type:"primary",title:"编辑"},on:{click:function(a){return t.updateUser(e.row,e.$index)}}},[t._v("编辑\n                        ")]),t._v(" "),a("el-button",{attrs:{title:"删除",size:"mini",plain:"",type:"danger"},on:{click:function(a){return t.delUser(e.row,e.$index)}}},[t._v("删除\n                        ")])]}}])})],1),t._v(" "),a("el-pagination",{attrs:{"current-page":t.page.pageNum,"page-sizes":t.page.pageSizes,"page-size":t.page.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.page.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),t._v(" "),t.orgUpdateVisable?a("el-dialog",{attrs:{title:t.dialogTitle,visible:t.orgUpdateVisable,width:"40%","close-on-click-modal":!1},on:{"update:visible":function(e){t.orgUpdateVisable=e}}},[a("org-update",{attrs:{currentRow:t.currentRow,isEdit:t.isEdit},on:{updateCallback:t.updateCallback}})],1):t._e()],1)],1)],1)},staticRenderFns:[]};var d=a("C7Lr")(l,c,!1,function(t){a("Q6Dr")},"data-v-0ec53582",null);e.default=d.exports},Q6Dr:function(t,e){},WkoH:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={name:"orgUpdate",props:["isEdit","currentRow"],data:function(){return{rules:{orgCode:[{required:!0,message:"请输入机构代码",tigger:"change"}],orgName:[{required:!0,message:"请输入机构名",tigger:"change"}]},orgForm:{orgId:"",orgCode:"",orgName:"",orgStatus:"",orgType:"",orgPid:""},formLabelWidth:"110px"}},created:function(){this.orgForm.orgId=this.currentRow.orgId,this.orgForm.orgCode=this.currentRow.orgCode,this.orgForm.orgName=this.currentRow.orgName,this.orgForm.orgStatus=this.currentRow.orgStatus,this.orgForm.orgType=this.currentRow.orgType,this.orgForm.orgPid=this.currentRow.orgPid},methods:{saveOrgManage:function(t){var e=this;this.$refs.orgForm.validate(function(a){if(!a)return!1;var r=e,o="";o=e.isEdit?r.API.updateOrganization:r.API.insertOrganization,r.$http({url:r.$http.adornUrl(o),method:"post",data:r.$http.adornData(t)}).then(function(t){0===t.data.code?(r.$message.success("操作成功"),e.$emit("updateCallback",!0)):r.$message.error("操作失败，请重新尝试")}).catch(function(t){})})},resetForm:function(t){var e=this;this.$nextTick(function(){void 0!==e.$refs[t]&&e.$refs[t].resetFields()})}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{ref:"orgForm",attrs:{model:t.orgForm,rules:t.rules,size:"small"}},[a("el-form-item",{attrs:{label:"机构代码","label-width":t.formLabelWidth,prop:"orgCode"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.orgForm.orgCode,callback:function(e){t.$set(t.orgForm,"orgCode",e)},expression:"orgForm.orgCode"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"机构名称","label-width":t.formLabelWidth,prop:"orgName"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.orgForm.orgName,callback:function(e){t.$set(t.orgForm,"orgName",e)},expression:"orgForm.orgName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"机构类型",prop:"orgType","label-width":t.formLabelWidth}},[a("el-select",{staticStyle:{width:"100%"},model:{value:t.orgForm.orgType,callback:function(e){t.$set(t.orgForm,"orgType",e)},expression:"orgForm.orgType"}},[a("el-option",{attrs:{label:"单位",value:"1"}}),t._v(" "),a("el-option",{attrs:{label:"部门",value:"2"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"机构状态","label-width":t.formLabelWidth,prop:"orgStatus"}},[a("el-radio-group",{model:{value:t.orgForm.orgStatus,callback:function(e){t.$set(t.orgForm,"orgStatus",e)},expression:"orgForm.orgStatus"}},[a("el-radio",{attrs:{label:"0"}},[t._v("启用")]),t._v(" "),a("el-radio",{attrs:{label:"1"}},[t._v("禁用")])],1)],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.saveOrgManage(t.orgForm)}}},[t._v("保存")]),t._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(e){return t.resetForm("orgForm")}}},[t._v("重置")])],1)],1)},staticRenderFns:[]};var i=a("C7Lr")(r,o,!1,function(t){a("56nC")},"data-v-5f9f652e",null);e.default=i.exports}});
//# sourceMappingURL=23.54b4401e0de437693c66.js.map